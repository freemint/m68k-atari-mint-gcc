# multilibs for Atari ST TOS/MiNT  -*- mode:Makefile -*-
#
# Copyright (C) 2007-2023 Free Software Foundation, Inc.
#
# This file is part of GCC.
#
# GCC is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3, or (at your option)
# any later version.
#
# GCC is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with GCC; see the file COPYING3.  If not see
# <http://www.gnu.org/licenses/>.

# An awk command to extract lines from the m68k-devices.def file that
# match $1 and then print the string defined by $2.  Leading and
# trailing whitespace is removed.  $1 & $2 can make use of
# CPU -- the cpu identifier (has leading 'm'/'mcf')
# FLAGS -- the cpu capability flags
# CPU_NAME -- the cpu name (has no leading m/mcf)
# MLIB -- the multilib cpu name (no leading m/mcf)
# This is intended to be used as $(call M68K_AWK,predicate,string)
M68K_AWK = $(strip $(shell $(AWK) 'BEGIN { FS="[ \t]*[,()][ \t]*"; ORS=" " }; \
	/^M68K_DEVICE/ { CPU=$$3; FLAGS=$$8; \
	CPU_NAME=substr($$2,2,length($$2)-2); \
	MLIB=substr($$5,2,length($$5)-2); \
	if ($1) print $2 }' $(srcdir)/config/m68k/m68k-devices.def))

# Add a multilib for each distinct architecture.  M68K_MLIB_CPU, if defined,
# adds additional restrictions.
M68K_MLIB_CPUS := $(call M68K_AWK,\
	(CPU_NAME == MLIB) $(M68K_MLIB_CPU), \
	"m"MLIB)

# Make the default cpu the default multilib.
M68K_MLIB_DEFAULT := $(call M68K_AWK, CPU == "$(target_cpu_default)", MLIB)

ifeq ($(filter m$(M68K_MLIB_DEFAULT),$(M68K_MLIB_CPUS)),)
$(error Error default cpu '$(target_cpu_default)' is not in multilib set '$(M68K_MLIB_CPUS)')
endif

MULTILIB_OPTIONS = m68020-60/mcpu=5475 mshort

MULTILIB_DIRNAMES = m68020-60 m5475 mshort

MULTILIB_MATCHES = \
	m68020-60=m68881 \
	m68020-60=m68020 \
	m68020-60=m68020-40 \
	m68020-60=mc68020 \
	m68020-60=m68030 \
	m68020-60=m68040 \
	m68020-60=m68060 \
	m68020-60=mcpu?68020 \
	m68020-60=mcpu?68030 \
	m68020-60=mcpu?68040 \
	m68020-60=mcpu?68060 \
	m68020-60=march?68020 \
	m68020-60=march?68030 \
	m68020-60=march?68040 \
	m68020-60=march?68060 \
	mcpu?5475=mcfv4e \
	mcpu?5475=mcpu?5470 \
	mcpu?5475=mcpu?5471 \
	mcpu?5475=mcpu?5472 \
	mcpu?5475=mcpu?5473 \
	mcpu?5475=mcpu?5474 \
	mcpu?5475=mcpu?547x \
	mcpu?5475=mcpu?5480 \
	mcpu?5475=mcpu?5481 \
	mcpu?5475=mcpu?5482 \
	mcpu?5475=mcpu?5483 \
	mcpu?5475=mcpu?5484 \
	mcpu?5475=mcpu?5485 \
	mcpu?5475=mcpu?548x

MULTILIB_EXCEPTIONS :=
